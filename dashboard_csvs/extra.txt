const { error: dbError } = await supabase
          .from(tableId)
          .update(record)
          .eq("uid", editingItem.rowUid);
        
        if (dbError) throw dbError;

        // Use the actual UI section ID from teacherDashboard.json for local state update
        const localSectionId = sectionId === "teacherProfileForm" ? "profile" : uiSectionId;

        setLocalData(prev => ({
          ...prev,
          [localSectionId]: prev[localSectionId]?.map(item => 
            item.uid === editingItem.rowUid ? { ...item, ...record } : item
          ) || []
        }));
        setEditingItem(null);
        alert("Record updated successfully.");
        ////////////////////////////
         const isEdit = editingItem && editingItem.formId === sectionId;
    const options = isEdit ? { mode: "update" } : { mode: "create" };

    // Adapter mapping fix: 'teacherProfileForm' uses 'addTeacherForm' logic
    const resolvedFormId = sectionId === "teacherProfileForm" ? "addTeacherForm" : sectionId;

    const { tableId, uiSectionId, record } = processFormData(resolvedFormId, values, rules, options);

    if (!tableId) {
      setIsSubmitting(false);
      return;
    }

    try {
      if (isEdit) {
        // Update existing row
        const { error: dbError } = await supabase
          .from(tableId)
          .update(record)
          .eq("uid", editingItem.rowUid);
      
        if (dbError) throw dbError;
      
        // Update local state
        setLocalData(prev => ({
          ...prev,
          [uiSectionId]: prev[uiSectionId]?.map(item =>
            item.uid === editingItem.rowUid ? { ...item, ...record } : item
          ) || []
        }));
      
        setEditingItem(null);
        alert("Record updated successfully.");
      } else {
        // Create new row
        const { data: newRows, error: dbError } = await supabase.from(tableId)
          .insert([record])
          .select();
        if (dbError) throw dbError;
      
        // Update local state
        setLocalData(prev => ({
          ...prev,
          [uiSectionId]: [...(prev[uiSectionId] || []), newRows[0]]
        }));
      
        alert("Record created successfully.");
      }  
      e.target.reset();
    } catch (err) {
      alert(`Submission Error: ${err.message}`);
    } finally {
      setIsSubmitting(false);
    }